\documentclass[10pt]{article}

\usepackage[utf8]{inputenc}
\usepackage[margin=0.5in]{geometry}
\usepackage{kpfonts}

\PassOptionsToPackage{usenames, dvipsnames}{xcolor}
\usepackage{figures/tikzit}

\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{stmaryrd}
\usepackage{microtype}
\usepackage{enumitem}

\usepackage[style=alphabetic]{biblatex}
\usepackage[colorlinks=true, citecolor=Green, linkcolor=NavyBlue, urlcolor=BrickRed]{hyperref}
\usepackage[capitalise]{cleveref}

\input{macros/sets}
\input{macros/category}
\input{macros/streams}
\input{macros/circuits}
\input{macros/theorems}

\input{figures/circuits.tikzstyles}
\input{figures/circuits.tikzdefs}

\setcounter{biburlnumpenalty}{100}
\setcounter{biburlucpenalty}{100}
\setcounter{biburllcpenalty}{100}

\addbibresource{refs/refs.biblatex.bib}
\pagenumbering{gobble} 

\title{\vspace{-3em}Full abstraction for digital circuits: \textbf{Extended abstract}}
\author{\textbf{George Kaye}, David Sprunger and Dan R. Ghica}

\begin{document}
    \maketitle

    \paragraph*{Motivation.}
    Digital circuits are ubiquitous in today's society, so it is essential that we have easy ways to verify their correctness and reason with them.
    Conventionally, this is done by translation into an executable model such as an automaton, which can be simulated to observe its behaviour.
    An alternative approach, used commonly in software, is to reason \emph{syntactically}: programs are formulated equationally and can be reduced step by step by identifying \emph{redexes} in terms.
    When provided with inputs, the goal of such a system is to apply redexes and eventually return an output value.

    Such an equational system was first presented in~\cite{ghica2016categorical,ghica2017diagrammatic}, in which digital circuits with delay and feedback are modelled as morphisms in a freely generated traced cartesian category, or \emph{dataflow category}~\cite{cazanescu1990new,cazanescu1994feedback}.
    However, there were some informalities in the presentation, and, crucially, the framework was not guaranteed to reduce circuits with \emph{non-delay-guarded feedback} to a value.
    Our work brings this project to its conclusion.

    \paragraph*{Syntax.}
    Before we can start constructing circuits, we must specify the components we can use.

    \begin{definition}[Circuit signature]
        Let \(\Sigma\) be a tuple \((\mathcal{V},\mathcal{G})\) where \(\mathcal{V}\) is a finite set of \emph{values} and \(\mathcal{G}\) is a finite set of tuples \((g,m)\) where \(g\) is a \emph{gate symbol} and \(m \in \nat\) is its \emph{arity}.
    \end{definition}

    \begin{definition}[Sequential circuits]
        For a signature \(\Sigma\), let \(\scircsigma\) be the symmetric traced monoidal category freely generated over:
        \begin{align*}
            \iltikzfig{strings/structure/monoid/init} 
            &&
            \iltikzfig{strings/structure/monoid/init-white} 
            &&
            \iltikzfig{circuits/components/values/v}\ \text{for each}\ v \in \circuitsignaturevalues
            &&
            \iltikzfig{circuits/components/gates/gate-labelled}\ \text{for each}\ (g,m) \in \circuitsignaturegates
            &&
            \iltikzfig{strings/structure/comonoid/copy}
            &&
            \iltikzfig{strings/structure/monoid/merge}
            &&
            \iltikzfig{strings/structure/comonoid/discard}
            &&
            \iltikzfig{circuits/components/delay}
        \end{align*}
    \end{definition}    

    \noindent
    The small boxes are \emph{values}: these represent the signals that can flow through our circuits.
    The first two are special: \iltikzfig{strings/structure/monoid/init} represents a \emph{disconnected wire}: a \emph{lack} of information.
    Conversely, \iltikzfig{strings/structure/monoid/init-white} represents a \emph{short circuit}: a \emph{glut} of information.
    The remaining values are specified by our signature.
    Next come the generators for each gate symbol in our signature, and three \emph{structural} generators for forking, joining and stubbing wires.
    The final generator is a \emph{delay} generator: one can think of this as delaying its inputs for one tick of the clock.
    We write arbitrary sequential circuits obtained by composing generators together as squares \iltikzfig{circuits/components/circuits/f-seq}.
    If a circuit is \emph{combinational}, i.e. it contains no delay or trace, it is drawn in a lighter square \iltikzfig{circuits/components/circuits/f-comb}.

    \paragraph*{Semantics.}

    Circuits specified syntactically have no computational content associated with them.
    To add \emph{semantics} to circuits, first the signature must be interpreted in some domain.

    \begin{definition}[Interpretation]\label{def:interpretation}
        Let \(\circuitsignature = (\circuitsignaturevalues,\circuitsignaturegates)\) be a circuit signature.
        A interpretation of \(\circuitsignature\) is a tuple \(\interpretation = (\mathbf{V}, \valueinterpretation,\gateinterpretation)\) where \(\values\) is a finite lattice, \(\valueinterpretation\) is a bijective function \(\valueinterpretation \to \values \setminus \{\bot,\top\}\) and \(\gateinterpretation\) is a map from each gate \((g,m) \in \circuitsignaturegates\) to a monotone function \(\morph{\overline{g}}{\valuetuple{m}}{\values}\).
    \end{definition}

    \noindent
    The semantics of circuits is that of \emph{stream functions}, which take as input a stream and output a stream.
    In particular, we are interested in stream functions of the form \(\valuetuplestream{m} \to \valuetuplestream{n}\).

    \begin{definition}
        For an interpretation \(\interpretation = (\values, \valueinterpretation, \gateinterpretation)\), let \(\streami\) be the prop with morphisms \(m \to n\) as stream functions \(\valuetuplestream{m} \to \valuetuplestream{n}\) freely generated over
        stream functions for values \(\morph{\tilde{v}}{0}{1}\) for each \(v \in \values\), defined as \(\tilde{v}(0) = v\) and \(\tilde{v}(i) = \bot\); for gates \(\morph{\tilde{g}}{m}{1}\) for each \((g,m) \in \circuitsignaturegates\) defined as \(\tilde{g}(\sigma)(i) = g(\sigma(i))\); and for delay \(\morph{\delay}{1}{1}\) defined as \(\delay(\sigma)(0) = \bot\) and \(\delay(\sigma)(i+1)\).
    \end{definition}

    \begin{theorem}
        \(\streami\) is traced.
    \end{theorem}

    \begin{definition}\label{def:circuittostreams}
        Let \(\morph{\circuittostream{\interpretation}}{\scircsigma}{\streami}\) be a traced prop morphism, mapping circuits to appropriate stream functions.
        The details are omitted, see~\cite{ghica2022full}.
    \end{definition}

    \noindent
    If two circuits map to the same semantics in \(\streami\), we say they are \emph{extensionally equivalent}, written \(\iltikzfig{circuits/components/circuits/f-seq} \extequivi \iltikzfig{circuits/components/circuits/g-seq}\).

    \begin{theorem}[\cite{ghica2022full}]
        Let \(\scircsigmai\) be the category obtained by quotienting \(\scircsigma\) by \(\extequivi\).
        Then, \(\scircsigmai \cong \streami\).
    \end{theorem}

    \paragraph*{Equational reasoning.}

    Circuits of different structure can have the same semantics.
    However, in general it is prohibitive to check that the corresponding streams for two circuits are equal~\cite{ghica2017diagrammatica}: it is more efficient to reason \emph{equationally}.
    
    Equations are identities that hold in the quotient category \(\scircsigmai\).
    Given a set of equations \(\mathcal{E}\), we write \(\iltikzfig{circuits/components/circuits/f-seq} \eqaxioms{\mathcal{E}} \iltikzfig{circuits/components/circuits/g-seq}\) if \iltikzfig{circuits/components/circuits/f-seq} can be rewritten to \iltikzfig{circuits/components/circuits/g-seq} by equations in \(\mathcal{E}\).
    Note that since we are using string diagrams, the axioms of STMCs are `absorbed' into the notation and always hold.
    To explictly indicate when we are `applying' these axioms by mutating the diagram we will write \(\eqaxioms{STMC}\).

    \begin{figure}
        \centering
        \begin{align*}
            \iltikzfig{circuits/axioms/join-lhs}
            &\eqaxiomsc
            \iltikzfig{circuits/axioms/join-rhs}
            &
            \iltikzfig{circuits/axioms/gate-lhs}
            &\eqaxiomsc
            \iltikzfig{circuits/axioms/gate-rhs}
            &
            \iltikzfig{strings/structure/comonoid/unitality-l-lhs}
            &\eqaxiomsc
            \iltikzfig{strings/structure/comonoid/unitality-l-rhs}
            \eqaxiomsc
            \iltikzfig{strings/structure/comonoid/unitality-r-lhs}
            &
            \iltikzfig{circuits/axioms/gate-lhs}
            &\eqaxiomsc
            \iltikzfig{circuits/axioms/gate-rhs} 
            &
            \iltikzfig{circuits/axioms/disconnect-lhs}
            &\eqaxiomsc
            \iltikzfig{circuits/axioms/disconnect-rhs} 
            \\
        \end{align*}
        \begin{align*}
            \iltikzfig{strings/cartesian/naturality-copy-lhs}
            &\eqaxiomsc
            \iltikzfig{strings/cartesian/naturality-copy-rhs}
            &
            \iltikzfig{strings/cartesian/naturality-discard-lhs}
            &\eqaxiomsc
            \iltikzfig{strings/cartesian/naturality-discard-rhs}
            &
            \iltikzfig{circuits/axioms/streaming-lhs}
            &\eqaxiomsc
            \iltikzfig{circuits/axioms/streaming-rhs} 
            &
            \iltikzfig{circuits/instant-feedback/axiom-lhs}
            &\eqaxiomsc
            \iltikzfig{circuits/instant-feedback/axiom-rhs}
        \end{align*}
        \caption{The set of axioms \(\mathcal{C}\) for reducing closed circuits.}
    \end{figure}

    \paragraph*{Productivity.}
    A common use of equational reasoning is to take a circuit and reduce it to its output values.

    \begin{definition}[Productivity]
        For a set of equations \(\mathcal{E}\), a closed sequential circuit \iltikzfig{circuits/components/fcirc-closed-traced} is called \emph{productive under} \(\mathcal{E}\) if there exist values \iltikzfig{circuits/components/values/vs} and sequential circuit \iltikzfig{circuits/components/gcirc-closed-traced} such that
        \(
            \iltikzfig{circuits/components/fcirc-closed-traced} 
            \eqaxioms{\mathcal{E}}
            \iltikzfig{circuits/productivity/productive}
        \).
    \end{definition}

    \noindent
    A set of axioms was presented in~\cite{ghica2016categorical}.
    However, there was a shortcoming: these axioms could not reliably handle circuits with \emph{non-delay-guarded feedback}, in which every feedback loop does not pass through a delay generator.
    Such circuits are generally not handled well by traditional tools, so one might imagine that such circuits are not useful.
    However, in some circuits `instant feedback' can actually be beneficial: for example, it can be used to share resources between different parts of a circuit~\cite{riedel2004cyclic,mendler2012constructive}.

    \begin{definition}
       
        For a combinational circuit 
        \(\iltikzfig{circuits/instant-feedback/fixpoint-lhs}\)
        , let its \emph{\(n\)th iteration} 
        \(\iltikzfig{circuits/instant-feedback/fn-box}\) 
        z
        be defined recursively as 
        \(
            \iltikzfig{circuits/instant-feedback/f0-box} 
            := 
            \iltikzfig{circuits/instant-feedback/f0-definition}
        \) 
        and 
        \(
            \iltikzfig{circuits/instant-feedback/fkp1-box} 
            := 
            \iltikzfig{circuits/instant-feedback/fkp1-definition}
        \).
        Let \(\interpretation = (\values,\valueinterpretation,\gateinterpretation)\) be an interpretation and let \(c\) be the length of the longest chain in \(\values\): the \emph{fixpoint} of 
        \(\iltikzfig{circuits/instant-feedback/fixpoint-lhs}\)
        in \(\interpretation\), denoted as 
        \(\iltikzfig{circuits/instant-feedback/fixpoint}\)
        , is defined as \(\iltikzfig{circuits/instant-feedback/fc-box}\).
    \end{definition}

    \begin{theorem}
        Any sequential circuit \iltikzfig{circuits/components/circuits/f-seq-closed} is productive under \(\mathcal{C}\).
    \end{theorem}

    \noindent
    By repeatedly applying productivity, a stream of values can be obtained for \emph{any} sequential circuit \(\iltikzfig{circuits/components/circuits/f-seq}\) given some inputs \(\iltikzfig{circuits/components/values/vs}\).

    \paragraph*{Full abstraction.}

    When face

    \begin{definition}
        A set of equational \(\mathcal{E}\)
    \end{definition}


    \begin{theorem}[Full abstraction]
        Let \(\mathcal{E}\) be a Given m then \(\iltikzfig{circuits/components/circuits/f-seq} \eqaxioms{\mathcal{C} + \mathcal{E}}\) if and only if \(\circuittostream[\iltikzfig{circuits/components/circuits/f-seq}]{\interpretation} = \circuittostream[\iltikzfig{circuits/components/circuits/g-seq}]{\interpretation}\).
    \end{theorem}
    \begin{proof}
        
    \end{proof}

    \printbibliography[heading=bibintoc,title={References}]

\end{document}
